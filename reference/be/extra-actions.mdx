---
title: 'extra-actions'
---

# Extra Actions Rules

{% dynamic setvar source_file "src/main/java/com/google/devtools/build/docgen/templates/be/rules.vm" %}
{% include "\_buttons.html" %}

## Rules

- [action_listener](#action_listener)
- [extra_action](#extra_action)

## action_listener

<a href="https://github.com/bazelbuild/bazel/blob/master/src/main/java/com/google/devtools/build/lib/rules/extra/ActionListenerRule.java" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
action_listener(name, aspect_hints, compatible_with, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, extra_actions, features, licenses, mnemonics, package_metadata, restricted_to, tags, target_compatible_with, testonly, visibility)
```

**WARNING:** Extra actions are deprecated. Use
[aspects](https://bazel.build/rules/aspects)
instead.

An `action_listener` rule doesn't produce any output itself.
Instead, it allows tool developers to insert
[`extra_action`](/reference/be/extra-actions.html#extra_action)s into the build system,
by providing a mapping from action to [`extra_action`](/reference/be/extra-actions.html#extra_action)
.

This rule's arguments map action mnemonics to
[`extra_action`](/reference/be/extra-actions.html#extra_action) rules.

By specifying the option
[`--experimental_action_listener=<label>`](/docs/user-manual#flag--experimental_action_listener),
the build will use the specified `action_listener` to insert
[`extra_action`](/reference/be/extra-actions.html#extra_action)s into the build graph.

#### Example


    action_listener(
        name = "index_all_languages",
        mnemonics = [
            "Javac",
            "CppCompile",
            "Python",
        ],
        extra_actions = [":indexer"],
    )

    action_listener(
        name = "index_java",
        mnemonics = ["Javac"],
        extra_actions = [":indexer"],
    )

    extra_action(
        name = "indexer",
        tools = ["//my/tools:indexer"],
        cmd = "$(location //my/tools:indexer)" +
              "--extra_action_file=$(EXTRA_ACTION_FILE)",
    )

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="action_listener.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p></td>
</tr>
<tr>
<td id="action_listener.extra_actions"><code>extra_actions</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; required</p>
A list of <a href="/reference/be/extra-actions.html#extra_action"><code>extra_action</code></a> targets
this <code>action_listener</code> should add to the build graph.
E.g. <code>[ "//my/tools:analyzer" ]</code>.</td>
</tr>
<tr>
<td id="action_listener.mnemonics"><code>mnemonics</code></td>
<td><p>List of strings; required</p>
A list of action mnemonics this <code>action_listener</code> should listen
for, e.g. <code>[ "Javac" ]</code>.
<p>Mnemonics are not a public interface.
There's no guarantee that the mnemonics and their actions don't change.</p></td>
</tr>
</tbody>
</table>

## extra_action

<a href="https://github.com/bazelbuild/bazel/blob/master/src/main/java/com/google/devtools/build/lib/rules/extra/ExtraActionRule.java" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
extra_action(name, data, aspect_hints, cmd, compatible_with, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, features, licenses, out_templates, package_metadata, requires_action_output, restricted_to, tags, target_compatible_with, testonly, toolchains, tools, visibility)
```

**WARNING:** Extra actions are deprecated. Use
[aspects](https://bazel.build/rules/aspects)
instead.

An `extra_action` rule doesn't produce any meaningful output
when specified as a regular build target. Instead, it allows tool developers
to insert additional actions into the build graph that shadow existing actions.

See [`action_listener`](/reference/be/extra-actions.html#action_listener) for details
on how to enable `extra_action`s.

The `extra_action`s run as a command-line. The command-line tool gets
access to a file containing a protocol buffer as \$(EXTRA_ACTION_FILE)
with detailed information on the original action it is shadowing.
It also has access to all the input files the original action has access to.
See `extra_actions_base.proto`
for details on the data stored inside the protocol buffer. Each proto file
contains an ExtraActionInfo message.

Just like all other actions, extra actions are sandboxed, and should be designed to handle that.

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="extra_action.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p>
You may refer to this rule by <code>label</code> in the <code>extra_actions</code> argument
of <a href="/reference/be/extra-actions.html#action_listener"><code> action_listener</code></a> rules.</td>
</tr>
<tr>
<td id="extra_action.cmd"><code>cmd</code></td>
<td><p>String; required</p>
The command to run.
<p>Like <a href="/reference/be/general.html#genrule.cmd">genrule cmd attribute</a> with the following
differences:</p>
<ol>
<li><p>No heuristic label expansion. Only labels using $(location ...) are expanded.</p></li>
<li><p>An additional pass is applied to the string to replace all
occurrences of the outputs created from the <code>out_templates</code>
attribute. All occurrences of <code>$(output </code><em><code>out_template</code></em><code>)</code>
are replaced with the path to the file denoted by <code>label</code>.</p>
<p>E.g. out_template <code>$(ACTION_ID).analysis</code>
can be matched with <code>$(output $(ACTION_ID).analysis)</code>.</p>
<p>In effect, this is the same substitution as <code>$(location)</code>
but with a different scope.</p></li>
</ol></td>
</tr>
<tr>
<td id="extra_action.out_templates"><code>out_templates</code></td>
<td><p>List of strings; default is <code>[]</code></p>
A list of templates for files generated by the <code>extra_action</code> command.
<p>The template can use the following variables:</p>
<ul>
<li>$(ACTION_ID), an id uniquely identifying this <code>extra_action</code>.
Used to generate a unique output file.</li>
</ul></td>
</tr>
<tr>
<td id="extra_action.requires_action_output"><code>requires_action_output</code></td>
<td><p>Boolean; default is <code>False</code></p>
Indicates this <code>extra_action</code> requires the output of the
original action to be present as input to this <code>extra_action</code>.
<p>When true (default false), the extra_action can assume that the
original action outputs are available as part of its inputs.</p></td>
</tr>
<tr>
<td id="extra_action.tools"><code>tools</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
A list of <code>tool</code> dependencies for this rule.
<p>See the definition of <a href="/concepts/build-ref#deps">dependencies</a> for more
information.</p>
<p>The build system ensures these prerequisites are built before running the
<code>extra_action</code> command; they are built using the
<a href="/docs/user-manual#configurations"><code>exec</code>configuration</a>,
since they must run as a tool during the build itself. The path of an individual
<code>tools</code> target <code>//x:y</code> can be obtained using
<code>$(location //x:y)</code>.</p>
<p>All tools and their data dependencies are consolidated into a single tree
within which the command can use relative paths. The working directory will
be the root of that unified tree.</p></td>
</tr>
</tbody>
</table>
