---
title: 'protocol-buffer'
---

# Protocol Buffer Rules

{% dynamic setvar source_file "src/main/java/com/google/devtools/build/docgen/templates/be/rules.vm" %}
{% include "\_buttons.html" %}

## Rules

- [cc_proto_library](#cc_proto_library)
- [java_lite_proto_library](#java_lite_proto_library)
- [java_proto_library](#java_proto_library)
- [proto_library](#proto_library)
- [py_proto_library](#py_proto_library)
- [proto_lang_toolchain](#proto_lang_toolchain)
- [proto_toolchain](#proto_toolchain)

## cc_proto_library

<a href="https://github.com/protocolbuffers/protobuf/tree/v29.0-rc2/bazel/private/bazel_cc_proto_library.bzl" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
cc_proto_library(name, deps, aspect_hints, compatible_with, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, features, package_metadata, restricted_to, tags, target_compatible_with, testonly, toolchains, visibility)
```

`cc_proto_library` generates C++ code from `.proto` files.

`deps` must point to [`proto_library `](protocol-buffer.html#proto_library) rules.

Example:



    cc_library(
        name = "lib",
        deps = [":foo_cc_proto"],
    )

    cc_proto_library(
        name = "foo_cc_proto",
        deps = [":foo_proto"],
    )

    proto_library(
        name = "foo_proto",
    )

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="cc_proto_library.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p></td>
</tr>
<tr>
<td id="cc_proto_library.deps"><code>deps</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
The list of <a href="protocol-buffer.html#proto_library"><code>proto_library</code></a>
rules to generate C++ code for.</td>
</tr>
</tbody>
</table>

## java_lite_proto_library

<a href="https://github.com/protocolbuffers/protobuf/tree/v29.0-rc2/bazel/private/java_lite_proto_library.bzl" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
java_lite_proto_library(name, deps, aspect_hints, compatible_with, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, features, package_metadata, restricted_to, tags, target_compatible_with, testonly, toolchains, visibility)
```

`java_lite_proto_library` generates Java code from `.proto` files.

`deps` must point to [`proto_library `](protocol-buffer.html#proto_library) rules.

Example:

``` code


java_library(
    name = "lib",
    runtime_deps = [":foo"],
)

java_lite_proto_library(
    name = "foo",
    deps = [":bar"],
)

proto_library(
    name = "bar",
)
```

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="java_lite_proto_library.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p></td>
</tr>
<tr>
<td id="java_lite_proto_library.deps"><code>deps</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
The list of <a href="protocol-buffer.html#proto_library"><code>proto_library</code></a>
rules to generate Java code for.</td>
</tr>
</tbody>
</table>

## java_proto_library

<a href="https://github.com/protocolbuffers/protobuf/tree/v29.0-rc2/bazel/private/bazel_java_proto_library_rule.bzl" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
java_proto_library(name, deps, aspect_hints, compatible_with, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, features, licenses, package_metadata, restricted_to, tags, target_compatible_with, testonly, toolchains, visibility)
```

`java_proto_library` generates Java code from `.proto` files.

`deps` must point to [`proto_library `](protocol-buffer.html#proto_library) rules.

Example:

``` code


java_library(
    name = "lib",
    runtime_deps = [":foo_java_proto"],
)

java_proto_library(
    name = "foo_java_proto",
    deps = [":foo_proto"],
)

proto_library(
    name = "foo_proto",
)
```

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="java_proto_library.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p></td>
</tr>
<tr>
<td id="java_proto_library.deps"><code>deps</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
The list of <a href="protocol-buffer.html#proto_library"><code>proto_library</code></a>
rules to generate Java code for.</td>
</tr>
</tbody>
</table>

## proto_library

<a href="https://github.com/protocolbuffers/protobuf/tree/v29.0-rc2/bazel/private/proto_library_rule.bzl" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
proto_library(name, deps, srcs, data, allow_exports, aspect_hints, compatible_with, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, exports, features, import_prefix, licenses, option_deps, package_metadata, restricted_to, strip_import_prefix, tags, target_compatible_with, testonly, toolchains, visibility)
```

Use `proto_library` to define libraries of protocol buffers which
may be used from multiple languages. A `proto_library` may be listed
in the `deps` clause of supported rules, such as
`java_proto_library`.

When compiled on the command-line, a `proto_library` creates a file
named `foo-descriptor-set.proto.bin`, which is the descriptor set for
the messages the rule srcs. The file is a serialized
`FileDescriptorSet`, which is described in
<https://developers.google.com/protocol-buffers/docs/techniques#self-description>.

It only contains information about the `.proto` files directly
mentioned by a `proto_library` rule; the collection of transitive
descriptor sets is available through the
`[ProtoInfo].transitive_descriptor_sets` Starlark provider.
See documentation in `proto_info.bzl`.

Recommended code organization:

- One `proto_library` rule per `.proto` file.
- A file named `foo.proto` will be in a rule named `foo_proto`,
  which is located in the same package.
- A `[language]_proto_library` that wraps a `proto_library`
  named `foo_proto` should be called `foo_[language]_proto`,
  and be located in the same package.

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="proto_library.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p></td>
</tr>
<tr>
<td id="proto_library.deps"><code>deps</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
The list of other <code>proto_library</code> rules that the target depends upon.
A <code>proto_library</code> may only depend on other <code>proto_library</code>
targets. It may not depend on language-specific libraries.</td>
</tr>
<tr>
<td id="proto_library.srcs"><code>srcs</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
The list of <code>.proto</code> and <code>.protodevel</code> files that are
processed to create the target. This is usually a non empty list. One usecase
where <code>srcs</code> can be empty is an <em>alias-library</em>. This is a
proto_library rule having one or more other proto_library in <code>deps</code>.
This pattern can be used to e.g. export a public api under a persistent name.</td>
</tr>
<tr>
<td id="proto_library.allow_exports"><code>allow_exports</code></td>
<td><p><a href="/concepts/labels">Label</a>; default is <code>None</code></p>
An optional allowlist that prevents proto library to be reexported or used in
lang_proto_library that is not in one of the listed packages.</td>
</tr>
<tr>
<td id="proto_library.exports"><code>exports</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
List of proto_library targets that can be referenced via "import public" in the
proto source.
It's an error if you use "import public" but do not list the corresponding library
in the exports attribute.
Note that you have list the library both in deps and exports since not all
lang_proto_library implementations have been changed yet.</td>
</tr>
<tr>
<td id="proto_library.import_prefix"><code>import_prefix</code></td>
<td><p>String; default is <code>""</code></p>
The prefix to add to the paths of the .proto files in this rule.
<p>When set, the .proto source files in the <code>srcs</code> attribute of this rule are
accessible at is the value of this attribute prepended to their repository-relative path.</p>
<p>The prefix in the <code>strip_import_prefix</code> attribute is removed before this
prefix is added.</p></td>
</tr>
<tr>
<td id="proto_library.option_deps"><code>option_deps</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
The list of other <code>proto_library</code> rules that the target depends upon for options only.
A <code>proto_library</code> may only depend on other <code>proto_library</code>
targets. It may not depend on language-specific libraries.</td>
</tr>
<tr>
<td id="proto_library.strip_import_prefix"><code>strip_import_prefix</code></td>
<td><p>String; default is <code>"/"</code></p>
The prefix to strip from the paths of the .proto files in this rule.
<p>When set, .proto source files in the <code>srcs</code> attribute of this rule are
accessible at their path with this prefix cut off.</p>
<p>If it's a relative path (not starting with a slash), it's taken as a package-relative
one. If it's an absolute one, it's understood as a repository-relative path.</p>
<p>The prefix in the <code>import_prefix</code> attribute is added after this prefix is
stripped.</p></td>
</tr>
</tbody>
</table>

## py_proto_library

<a href="https://github.com/protocolbuffers/protobuf/tree/v29.0-rc2/bazel/py_proto_library.bzl" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
py_proto_library(name, deps, aspect_hints, compatible_with, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, features, package_metadata, restricted_to, tags, target_compatible_with, testonly, toolchains, visibility)
```

Use \`py_proto_library\` to generate Python libraries from \`.proto\` files.
The convention is to name the \`py_proto_library\` rule \`foo_py_pb2\`,
when it is wrapping \`proto_library\` rule \`foo_proto\`.
\`deps\` must point to a \`proto_library\` rule.
Example:
\`\`\`starlark
py_library(
name = "lib",
deps = \[":foo_py_pb2"\],
)
py_proto_library(
name = "foo_py_pb2",
deps = \[":foo_proto"\],
)
proto_library(
name = "foo_proto",
srcs = \["foo.proto"\],
)
\`\`\`

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="py_proto_library.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p></td>
</tr>
<tr>
<td id="py_proto_library.deps"><code>deps</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
The list of `proto_library` rules to generate Python libraries for.
Usually this is just the one target: the proto library of interest.
It can be any target providing `ProtoInfo`.</td>
</tr>
</tbody>
</table>

## proto_lang_toolchain

<a href="https://github.com/protocolbuffers/protobuf/tree/v29.0-rc2/bazel/private/proto_lang_toolchain_rule.bzl" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
proto_lang_toolchain(name, allowlist_different_package, aspect_hints, blacklisted_protos, command_line, compatible_with, denylisted_protos, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, features, mnemonic, output_files, package_metadata, plugin, plugin_format_flag, progress_message, protoc_minimal_do_not_use, restricted_to, runtime, tags, target_compatible_with, testonly, toolchain_type, toolchains, visibility)
```

If using Bazel, please load the rule from
<https://github.com/bazelbuild/rules_proto>.

Specifies how a LANG_proto_library rule (e.g., `java_proto_library`) should invoke the
proto-compiler.
Some LANG_proto_library rules allow specifying which toolchain to use using command-line flags;
consult their documentation.

Normally you should not write those kind of rules unless you want to
tune your Java compiler.

There's no compiler. The proto-compiler is taken from the proto_library rule we attach to. It is
passed as a command-line flag to Blaze.
Several features require a proto-compiler to be invoked on the proto_library rule itself.
It's beneficial to enforce the compiler that LANG_proto_library uses is the same as the one
`proto_library` does.

#### Examples

A simple example would be:

``` lang-starlark

proto_lang_toolchain(
    name = "javalite_toolchain",
    command_line = "--javalite_out=shared,immutable:$(OUT)",
    plugin = ":javalite_plugin",
    runtime = ":protobuf_lite",
)
```

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="proto_lang_toolchain.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p></td>
</tr>
<tr>
<td id="proto_lang_toolchain.allowlist_different_package"><code>allowlist_different_package</code></td>
<td><p><a href="/concepts/labels">Label</a>; default is <code>None</code></p></td>
</tr>
<tr>
<td id="proto_lang_toolchain.blacklisted_protos"><code>blacklisted_protos</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
Deprecated. Alias for <code>denylisted_protos</code>. Will be removed in a future release.</td>
</tr>
<tr>
<td id="proto_lang_toolchain.command_line"><code>command_line</code></td>
<td><p>String; required</p>
This value will be passed to proto-compiler to generate the code. Only include the parts
specific to this code-generator/plugin (e.g., do not include -I parameters)
<ul>
<li><code>$(OUT)</code> is LANG_proto_library-specific. The rules are expected to define
how they interpret this variable. For Java, for example, $(OUT) will be replaced with
the src-jar filename to create.</li>
</ul></td>
</tr>
<tr>
<td id="proto_lang_toolchain.denylisted_protos"><code>denylisted_protos</code></td>
<td><p>List of <a href="/concepts/labels">labels</a>; default is <code>[]</code></p>
No code will be generated for files in the <code>srcs</code> attribute of
<code>denylisted_protos</code>.
This is used for .proto files that are already linked into proto runtimes, such as
<code>any.proto</code>.</td>
</tr>
<tr>
<td id="proto_lang_toolchain.mnemonic"><code>mnemonic</code></td>
<td><p>String; default is <code>"GenProto"</code></p>
This value will be set as the mnemonic on protoc action.</td>
</tr>
<tr>
<td id="proto_lang_toolchain.output_files"><code>output_files</code></td>
<td><p>String; default is <code>"legacy"</code></p>
Controls how <code>$(OUT)</code> in <code>command_line</code> is formatted, either by
a path to a single file or output directory in case of multiple files.
Possible values are: "single", "multiple".</td>
</tr>
<tr>
<td id="proto_lang_toolchain.plugin"><code>plugin</code></td>
<td><p><a href="/concepts/labels">Label</a>; default is <code>None</code></p>
If provided, will be made available to the action that calls the proto-compiler, and will be
passed to the proto-compiler:
<code>--plugin=protoc-gen-PLUGIN=&lt;executable&gt;.</code></td>
</tr>
<tr>
<td id="proto_lang_toolchain.plugin_format_flag"><code>plugin_format_flag</code></td>
<td><p>String; default is <code>""</code></p>
If provided, this value will be passed to proto-compiler to use the plugin.
The value must contain a single %s which is replaced with plugin executable.
<code>--plugin=protoc-gen-PLUGIN=&lt;executable&gt;.</code></td>
</tr>
<tr>
<td id="proto_lang_toolchain.progress_message"><code>progress_message</code></td>
<td><p>String; default is <code>"Generating proto_library %{label}"</code></p>
This value will be set as the progress message on protoc action.</td>
</tr>
<tr>
<td id="proto_lang_toolchain.protoc_minimal_do_not_use"><code>protoc_minimal_do_not_use</code></td>
<td><p><a href="/concepts/labels">Label</a>; default is <code>None</code></p></td>
</tr>
<tr>
<td id="proto_lang_toolchain.runtime"><code>runtime</code></td>
<td><p><a href="/concepts/labels">Label</a>; default is <code>None</code></p>
A language-specific library that the generated code is compiled against.
The exact behavior is LANG_proto_library-specific.
Java, for example, should compile against the runtime.</td>
</tr>
<tr>
<td id="proto_lang_toolchain.toolchain_type"><code>toolchain_type</code></td>
<td><p><a href="/concepts/labels">Label</a>; default is <code>None</code></p></td>
</tr>
</tbody>
</table>

## proto_toolchain

<a href="https://github.com/protocolbuffers/protobuf/tree/v29.0-rc2/bazel/private/proto_toolchain_rule.bzl" class="button button-with-icon" target="_blank">View rule source<span class="material-icons icon-after" aria-hidden="true">open_in_new</span></a>

``` rule-signature
proto_toolchain(name, aspect_hints, command_line, compatible_with, deprecation, exec_compatible_with, exec_group_compatible_with, exec_properties, features, mnemonic, output_files, package_metadata, progress_message, proto_compiler, restricted_to, tags, target_compatible_with, testonly, toolchains, visibility)
```

### Arguments

<table class="table table-condensed table-bordered table-params">
<thead>
<tr>
<th colspan="2">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td id="proto_toolchain.name"><code>name</code></td>
<td><p><a href="/concepts/labels#target-names">Name</a>; required</p>
<p>A unique name for this target.</p></td>
</tr>
<tr>
<td id="proto_toolchain.command_line"><code>command_line</code></td>
<td><p>String; default is <code>"--descriptor_set_out=%s"</code></p></td>
</tr>
<tr>
<td id="proto_toolchain.mnemonic"><code>mnemonic</code></td>
<td><p>String; default is <code>"GenProtoDescriptorSet"</code></p></td>
</tr>
<tr>
<td id="proto_toolchain.output_files"><code>output_files</code></td>
<td><p>String; default is <code>"single"</code></p></td>
</tr>
<tr>
<td id="proto_toolchain.progress_message"><code>progress_message</code></td>
<td><p>String; default is <code>"Generating Descriptor Set proto_library %{label}"</code></p></td>
</tr>
<tr>
<td id="proto_toolchain.proto_compiler"><code>proto_compiler</code></td>
<td><p><a href="/concepts/labels">Label</a>; default is <code>None</code></p></td>
</tr>
</tbody>
</table>
