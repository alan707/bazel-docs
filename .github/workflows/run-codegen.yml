# This workflow is used to generate docs from the Bazel repo
name: Generate docs from Bazel repo
on:
    # when we land commits to the repo
    push:
        branches:
          - 'main'
    # called from trigger-from-bazel-repo.yml
    workflow_dispatch:
        inputs:
            bazelCommitHash:
                description: 'The commit hash of the Bazel repo to use'
                type: string
                default: origin/main
    # allow debugging by triggering from the GitHub UI
    workflow_call:
        inputs:
            bazelCommitHash:
                description: 'The commit hash of the Bazel repo to use'
                type: string
                default: origin/main
     
jobs:
    codegen:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v5
            - name: Checkout submodules
              run: git submodule update --init -- upstream
            
            - name: Checkout commit of BCR submodule
              working-directory: upstream
              run: git checkout ${{ inputs.bcrCommitHash }}

            - name: Clean up mdx files
              run: ./cleanup-mdx.sh

            - name: Generate docs
              run: ./copy-upstream-docs.sh

            - name: Assert that nothing is different
              run: git diff --exit-code
