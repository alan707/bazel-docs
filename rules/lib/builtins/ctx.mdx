---
title: 'ctx'
---

# ctx

{% dynamic setvar source_file "src/main/java/com/google/devtools/build/lib/starlarkbuildapi/StarlarkRuleContextApi.java" %}
{% include "\_buttons.html" %}
A context object that is passed to the implementation function for a rule or aspect. It provides access to the information and methods needed to analyze the current target.

In particular, it lets the implementation function access the current target's label, attributes, configuration, and the providers of its dependencies. It has methods for declaring output files and the actions that produce them.

Context objects essentially live for the duration of the call to the implementation function. It is not useful to access these objects outside of their associated function. See the [Rules page](https://bazel.build/extending/rules#implementation_function) for more information.

## Members

- [actions](#actions)
- [aspect_ids](#aspect_ids)
- [attr](#attr)
- [bin_dir](#bin_dir)
- [build_file_path](#build_file_path)
- [build_setting_value](#build_setting_value)
- [configuration](#configuration)
- [coverage_instrumented](#coverage_instrumented)
- [created_actions](#created_actions)
- [disabled_features](#disabled_features)
- [exec_groups](#exec_groups)
- [executable](#executable)
- [expand_location](#expand_location)
- [expand_make_variables](#expand_make_variables)
- [features](#features)
- [file](#file)
- [files](#files)
- [fragments](#fragments)
- [genfiles_dir](#genfiles_dir)
- [info_file](#info_file)
- [label](#label)
- [outputs](#outputs)
- [resolve_command](#resolve_command)
- [resolve_tools](#resolve_tools)
- [rule](#rule)
- [runfiles](#runfiles)
- [split_attr](#split_attr)
- [super](#super)
- [target_platform_has_constraint](#target_platform_has_constraint)
- [toolchains](#toolchains)
- [var](#var)
- [version_file](#version_file)
- [workspace_name](#workspace_name)

## actions

``` rule-signature
actions ctx.actions
```

Contains methods for declaring output files and the actions that produce them.

## aspect_ids

``` rule-signature
list ctx.aspect_ids
```

A list of ids for all aspects applied to the target. Only available in aspect implementation functions.

## attr

``` rule-signature
struct ctx.attr
```

A struct to access the values of the [attributes](https://bazel.build/extending/rules#attributes). The values are provided by the user (if not, a default value is used). The attributes of the struct and the types of their values correspond to the keys and values of the [`attrs` dict](../globals/bzl.html#rule.attrs) provided to the [`rule` function](../globals/bzl.html#rule). [See example of use](https://github.com/bazelbuild/examples/blob/main/rules/attributes/printer.bzl).

## bin_dir

``` rule-signature
root ctx.bin_dir
```

The root corresponding to bin directory.

## build_file_path

``` rule-signature
string ctx.build_file_path
```

Deprecated: Use `ctx.label.package + '/BUILD'`. The path to the BUILD file for this rule, relative to the source root.

## build_setting_value

``` rule-signature
unknown ctx.build_setting_value
```

Value of the build setting represented by the current target. If this isn't the context for an instance of a rule that sets the [`build_setting`](https://bazel.build/extending/config#rule-parameter) attribute, reading this is an error.

## configuration

``` rule-signature
configuration ctx.configuration
```

The default configuration. See the [configuration](../builtins/configuration.html) type for more details.

## coverage_instrumented

``` rule-signature
bool ctx.coverage_instrumented(target=None)
```

Returns whether code coverage instrumentation should be generated when performing compilation actions for this rule or, if `target` is provided, the rule specified by that Target. (If a non-rule or a Starlark rule Target is provided, this returns False.) Checks if the sources of the current rule (if no Target is provided) or the sources of Target should be instrumented based on the --instrumentation_filter and --instrument_test_targets config settings. This differs from `coverage_enabled` in the [configuration](../builtins/configuration.html), which notes whether coverage data collection is enabled for the entire run, but not whether a specific target should be instrumented.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="coverage_instrumented.target"><code>target</code></td>
<td><a href="../builtins/Target.html" class="anchor">Target</a>; or <code>None</code>;
default is <code>None</code><br />
A Target specifying a rule. If not provided, defaults to the current rule.</td>
</tr>
</tbody>
</table>

## created_actions

``` rule-signature
StarlarkValue ctx.created_actions()
```

For rules with [\_skylark_testable](../globals/bzl.html#rule._skylark_testable) set to `True`, this returns an `Actions` provider representing all actions created so far for the current rule. For all other rules, returns `None`. Note that the provider is not updated when subsequent actions are created, so you will have to call this function again if you wish to inspect them.  
  
This is intended to help write tests for rule-implementation helper functions, which may take in a `ctx` object and create actions on it.

## disabled_features

``` rule-signature
list ctx.disabled_features
```

The set of features that are explicitly disabled by the user for this rule.

## exec_groups

``` rule-signature
ExecGroupCollection ctx.exec_groups
```

A collection of the execution groups available for this rule, indexed by their name. Access with `ctx.exec_groups[name_of_group]`.

## executable

``` rule-signature
struct ctx.executable
```

A `struct` containing executable files defined in [label type attributes](../toplevel/attr.html#label) marked as [`executable=True`](../toplevel/attr.html#label.executable). The struct fields correspond to the attribute names. Each value in the struct is either a [`File`](../builtins/File.html) or `None`. If an optional attribute is not specified in the rule then the corresponding struct value is `None`. If a label type is not marked as `executable=True`, no corresponding struct field is generated. [See example of use](https://github.com/bazelbuild/examples/blob/main/rules/actions_run/execute.bzl).

## expand_location

``` rule-signature
string ctx.expand_location(input, targets=[])
```

Expands all `$(location ...)` templates in the given string by replacing `$(location //x)` with the path of the output file of target //x. Expansion only works for labels that point to direct dependencies of this rule or that are explicitly listed in the optional argument `targets`.  
  
`$(location ...)` will cause an error if the referenced target has multiple outputs. In this case, please use `$(locations ...)` since it produces a space-separated list of output paths. It can be safely used for a single output file, too.  
  
This function is useful to let the user specify a command in a BUILD file (like for `genrule`). In other cases, it is often better to manipulate labels directly.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="expand_location.input"><code>input</code></td>
<td><a href="../core/string.html" class="anchor">string</a>;
required<br />
String to be expanded.</td>
</tr>
<tr>
<td id="expand_location.targets"><code>targets</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../builtins/Target.html" class="anchor">Target</a>s;
default is <code>[]</code><br />
List of targets for additional lookup information. These are expanded as follows: A target with a single file in <code>DefaultInfo.files</code> expands to that file. Other targets expand to their <code>DefaultInfo.executable</code> file if set and if <code>--incompatible_locations_prefers_executable</code> is enabled, otherwise they expand to <code>DefaultInfo.files</code>.</td>
</tr>
</tbody>
</table>

May return `None`.

## expand_make_variables

``` rule-signature
string ctx.expand_make_variables(attribute_name, command, additional_substitutions)
```

**Deprecated.** Use [ctx.var](../builtins/ctx.html#var) to access the variables instead.  
Returns a string after expanding all references to "Make variables". The variables must have the following format: `$(VAR_NAME)`. Also, `$$VAR_NAME` expands to `$VAR_NAME`. Examples:

``` python

ctx.expand_make_variables("cmd", "$(MY_VAR)", {"MY_VAR": "Hi"})  # == "Hi"
ctx.expand_make_variables("cmd", "$$PWD", {})  # == "$PWD"
```

Additional variables may come from other places, such as configurations. Note that this function is experimental.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="expand_make_variables.attribute_name"><code>attribute_name</code></td>
<td><a href="../core/string.html" class="anchor">string</a>;
required<br />
The attribute name. Used for error reporting.</td>
</tr>
<tr>
<td id="expand_make_variables.command"><code>command</code></td>
<td><a href="../core/string.html" class="anchor">string</a>;
required<br />
The expression to expand. It can contain references to "Make variables".</td>
</tr>
<tr>
<td id="expand_make_variables.additional_substitutions"><code>additional_substitutions</code></td>
<td><a href="../core/dict.html" class="anchor">dict</a>;
required<br />
Additional substitutions to make beyond the default make variables.</td>
</tr>
</tbody>
</table>

## features

``` rule-signature
list ctx.features
```

The set of features that are explicitly enabled by the user for this rule. [See example of use](https://github.com/bazelbuild/examples/blob/main/rules/features/rule.bzl).

## file

``` rule-signature
struct ctx.file
```

A `struct` containing files defined in [label type attributes](../toplevel/attr.html#label) marked as [`allow_single_file`](../toplevel/attr.html#label.allow_single_file). The struct fields correspond to the attribute names. The struct value is always a [`File`](../builtins/File.html) or `None`. If an optional attribute is not specified in the rule then the corresponding struct value is `None`. If a label type is not marked as `allow_single_file`, no corresponding struct field is generated. It is a shortcut for:

``` python
list(ctx.attr.<ATTR>.files)[0]
```

In other words, use `file` to access the (singular) [default output](https://bazel.build/extending/rules#requesting_output_files) of a dependency. [See example of use](https://github.com/bazelbuild/examples/blob/main/rules/expand_template/hello.bzl).

## files

``` rule-signature
struct ctx.files
```

A `struct` containing files defined in [label](../toplevel/attr.html#label) or [label list](../toplevel/attr.html#label_list) type attributes. The struct fields correspond to the attribute names. The struct values are `list` of [`File`](../builtins/File.html)s. It is a shortcut for:

``` python
[f for t in ctx.attr.<ATTR> for f in t.files]
```

In other words, use `files` to access the [default outputs](https://bazel.build/extending/rules#requesting_output_files) of a dependency. [See example of use](https://github.com/bazelbuild/examples/blob/main/rules/depsets/foo.bzl).

## fragments

``` rule-signature
fragments ctx.fragments
```

Allows access to configuration fragments in target configuration.

## genfiles_dir

``` rule-signature
root ctx.genfiles_dir
```

The root corresponding to genfiles directory.

## info_file

``` rule-signature
File ctx.info_file
```

The file that is used to hold the non-volatile workspace status for the current build request. See documentation for --workspace_status_command for more information.

## label

``` rule-signature
Label ctx.label
```

The label of the target currently being analyzed.

## outputs

``` rule-signature
structure ctx.outputs
```

A pseudo-struct containing all the predeclared output files, represented by [`File`](../builtins/File.html) objects. See the [Rules page](https://bazel.build/extending/rules#files) for more information and examples.

This field does not exist on aspect contexts, since aspects do not have predeclared outputs.

The fields of this object are defined as follows. It is an error if two outputs produce the same field name or have the same label.

- If the rule declares an [`outputs`](../globals/bzl.html#rule.outputs) dict, then for every entry in the dict, there is a field whose name is the key and whose value is the corresponding `File`.
- For every attribute of type [`attr.output`](../toplevel/attr.html#output) that the rule declares, there is a field whose name is the attribute's name. If the target specified a label for that attribute, then the field value is the corresponding `File`; otherwise the field value is `None`.
- For every attribute of type [`attr.output_list`](../toplevel/attr.html#output_list) that the rule declares, there is a field whose name is the attribute's name. The field value is a list of `File` objects corresponding to the labels given for that attribute in the target, or an empty list if the attribute was not specified in the target.
- **(Deprecated)** If the rule is marked [`executable`](../globals/bzl.html#rule.executable) or [`test`](../globals/bzl.html#rule.test), there is a field named `"executable"`, which is the default executable. It is recommended that instead of using this, you pass another file (either predeclared or not) to the `executable` arg of [`DefaultInfo`](../providers/DefaultInfo.html).

## resolve_command

``` rule-signature
tuple ctx.resolve_command(*, command='', attribute=None, expand_locations=False, make_variables=None, tools=[], label_dict={}, execution_requirements={})
```

*(Experimental)* Returns a tuple `(inputs, command, empty list)` of the list of resolved inputs and the argv list for the resolved command both of them suitable for passing as the same-named arguments of the `ctx.action` method.  
**Note for Windows users**: this method requires Bash (MSYS2). Consider using `resolve_tools()` instead (if that fits your needs). The empty list is returned as the third member of the tuple for backwards compatibility.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="resolve_command.command"><code>command</code></td>
<td><a href="../core/string.html" class="anchor">string</a>;
default is <code>''</code><br />
Command to resolve.</td>
</tr>
<tr>
<td id="resolve_command.attribute"><code>attribute</code></td>
<td><a href="../core/string.html" class="anchor">string</a>; or <code>None</code>;
default is <code>None</code><br />
Name of the associated attribute for which to issue an error, or None.</td>
</tr>
<tr>
<td id="resolve_command.expand_locations"><code>expand_locations</code></td>
<td><a href="../core/bool.html" class="anchor">bool</a>;
default is <code>False</code><br />
Shall we expand $(location) variables? See <a href="#expand_location">ctx.expand_location()</a> for more details.</td>
</tr>
<tr>
<td id="resolve_command.make_variables"><code>make_variables</code></td>
<td><a href="../core/dict.html" class="anchor">dict</a>; or <code>None</code>;
default is <code>None</code><br />
Make variables to expand, or None.</td>
</tr>
<tr>
<td id="resolve_command.tools"><code>tools</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../builtins/Target.html" class="anchor">Target</a>s;
default is <code>[]</code><br />
List of tools (list of targets).</td>
</tr>
<tr>
<td id="resolve_command.label_dict"><code>label_dict</code></td>
<td><a href="../core/dict.html" class="anchor">dict</a>;
default is <code>{}</code><br />
Dictionary of resolved labels and the corresponding list of Files (a dict of Label : list of Files).</td>
</tr>
<tr>
<td id="resolve_command.execution_requirements"><code>execution_requirements</code></td>
<td><a href="../core/dict.html" class="anchor">dict</a>;
default is <code>{}</code><br />
Information for scheduling the action to resolve this command. See <a href="/reference/be/common-definitions#common.tags">tags</a> for useful keys.</td>
</tr>
</tbody>
</table>

## resolve_tools

``` rule-signature
tuple ctx.resolve_tools(*, tools=[])
```

Returns a tuple `(inputs, empty list)` of the depset of resolved inputs required to run the tools, suitable for passing as the same-named argument of the `ctx.actions.run` and `ctx.actions.run_shell` methods.  
  
In contrast to `ctx.resolve_command`, this method does not require that Bash be installed on the machine, so it's suitable for rules built on Windows. The empty list is returned as part of the tuple for backward compatibility.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="resolve_tools.tools"><code>tools</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../builtins/Target.html" class="anchor">Target</a>s;
default is <code>[]</code><br />
List of tools (list of targets).</td>
</tr>
</tbody>
</table>

## rule

``` rule-signature
rule_attributes ctx.rule
```

Rule attributes descriptor for the rule that the aspect is applied to. Only available in aspect implementation functions.

## runfiles

``` rule-signature
runfiles ctx.runfiles(files=[], transitive_files=None, collect_data=False, collect_default=False, symlinks={}, root_symlinks={})
```

Creates a runfiles object.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="runfiles.files"><code>files</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../builtins/File.html" class="anchor">File</a>s;
default is <code>[]</code><br />
The list of files to be added to the runfiles.</td>
</tr>
<tr>
<td id="runfiles.transitive_files"><code>transitive_files</code></td>
<td><a href="../builtins/depset.html" class="anchor">depset</a> of <a href="../builtins/File.html" class="anchor">File</a>s; or <code>None</code>;
default is <code>None</code><br />
The (transitive) set of files to be added to the runfiles. The depset should use the <code>default</code> order (which, as the name implies, is the default).</td>
</tr>
<tr>
<td id="runfiles.collect_data"><code>collect_data</code></td>
<td><a href="../core/bool.html" class="anchor">bool</a>;
default is <code>False</code><br />
<strong>Use of this parameter is not recommended. See <a href="https://bazel.build/extending/rules#runfiles">runfiles guide</a></strong>.
<p>Whether to collect the data runfiles from the dependencies in srcs, data and deps attributes.</p></td>
</tr>
<tr>
<td id="runfiles.collect_default"><code>collect_default</code></td>
<td><a href="../core/bool.html" class="anchor">bool</a>;
default is <code>False</code><br />
<strong>Use of this parameter is not recommended. See <a href="https://bazel.build/extending/rules#runfiles">runfiles guide</a></strong>.
<p>Whether to collect the default runfiles from the dependencies in srcs, data and deps attributes.</p></td>
</tr>
<tr>
<td id="runfiles.symlinks"><code>symlinks</code></td>
<td><a href="../core/dict.html" class="anchor">dict</a>; or <a href="../builtins/depset.html" class="anchor">depset</a> of <a href="../builtins/SymlinkEntry.html" class="anchor">SymlinkEntry</a>s;
default is <code>{}</code><br />
Either a SymlinkEntry depset or the map of symlinks to be added to the runfiles. Symlinks are always added under the main workspace's runfiles directory (e.g. <code>&lt;runfiles_root&gt;/_main/&lt;symlink_path&gt;</code>, <strong>not</strong> the directory corresponding to the current target's repository. See <a href="https://bazel.build/extending/rules#runfiles_symlinks">Runfiles symlinks</a> in the rules guide.</td>
</tr>
<tr>
<td id="runfiles.root_symlinks"><code>root_symlinks</code></td>
<td><a href="../core/dict.html" class="anchor">dict</a>; or <a href="../builtins/depset.html" class="anchor">depset</a> of <a href="../builtins/SymlinkEntry.html" class="anchor">SymlinkEntry</a>s;
default is <code>{}</code><br />
Either a SymlinkEntry depset or a map of symlinks to be added to the runfiles. See <a href="https://bazel.build/extending/rules#runfiles_symlinks">Runfiles symlinks</a> in the rules guide.</td>
</tr>
</tbody>
</table>

## split_attr

``` rule-signature
struct ctx.split_attr
```

A struct to access the values of attributes with split configurations. If the attribute is a label list, the value of split_attr is a dict of the keys of the split (as strings) to lists of the ConfiguredTargets in that branch of the split. If the attribute is a label, then the value of split_attr is a dict of the keys of the split (as strings) to single ConfiguredTargets. Attributes with split configurations still appear in the attr struct, but their values will be single lists with all the branches of the split merged together.

## super

``` rule-signature
unknown ctx.super()
```

Experimental: Calls parent's implementation function and returns its providers

## target_platform_has_constraint

``` rule-signature
bool ctx.target_platform_has_constraint(constraintValue)
```

Returns true if the given constraint value is part of the current target platform.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="target_platform_has_constraint.constraintValue"><code>constraintValue</code></td>
<td><a href="../providers/ConstraintValueInfo.html" class="anchor">ConstraintValueInfo</a>;
required<br />
The constraint value to check the target platform against.</td>
</tr>
</tbody>
</table>

## toolchains

``` rule-signature
ToolchainContext ctx.toolchains
```

Toolchains for the default exec group of this rule.

## var

``` rule-signature
dict ctx.var
```

Dictionary (String to String) of configuration variables.

## version_file

``` rule-signature
File ctx.version_file
```

The file that is used to hold the volatile workspace status for the current build request. See documentation for --workspace_status_command for more information.

## workspace_name

``` rule-signature
string ctx.workspace_name
```

The name of the workspace, which is effectively the execution root name and runfiles prefix for the main repo. If `--enable_bzlmod` is on, this is the fixed string `_main`. Otherwise, this is the workspace name as defined in the WORKSPACE file.
