---
title: 'build'
---

# BUILD files

{% dynamic setvar source_file "NONE" %}
{% include "\_buttons.html" %}
Methods available in BUILD files. See also the Build Encyclopedia for extra [functions](/reference/be/functions) and build rules, which can also be used in BUILD files.

## Members

- [depset](#depset)
- [existing_rule](#existing_rule)
- [existing_rules](#existing_rules)
- [exports_files](#exports_files)
- [glob](#glob)
- [module_name](#module_name)
- [module_version](#module_version)
- [package](#package)
- [package_default_visibility](#package_default_visibility)
- [package_group](#package_group)
- [package_name](#package_name)
- [package_relative_label](#package_relative_label)
- [repo_name](#repo_name)
- [repository_name](#repository_name)
- [select](#select)
- [subpackages](#subpackages)

## depset

``` rule-signature
depset depset(direct=None, order="default", *, transitive=None)
```

Creates a [depset](../builtins/depset.html). The `direct` parameter is a list of direct elements of the depset, and `transitive` parameter is a list of depsets whose elements become indirect elements of the created depset. The order in which elements are returned when the depset is converted to a list is specified by the `order` parameter. See the [Depsets overview](https://bazel.build/extending/depsets) for more information.

All elements (direct and indirect) of a depset must be of the same type, as obtained by the expression [`type(x)`](../globals/all#type).

Because a hash-based set is used to eliminate duplicates during iteration, all elements of a depset should be hashable. However, this invariant is not currently checked consistently in all constructors. Use the --incompatible_always_check_depset_elements flag to enable consistent checking; this will be the default behavior in future releases; see [Issue 10313](https://github.com/bazelbuild/bazel/issues/10313).

In addition, elements must currently be immutable, though this restriction will be relaxed in future.

The order of the created depset should be *compatible* with the order of its `transitive` depsets. `"default"` order is compatible with any other order, all other orders are only compatible with themselves.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="depset.direct"><code>direct</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a>; or <code>None</code>;
default is <code>None</code><br />
A list of <em>direct</em> elements of a depset.</td>
</tr>
<tr>
<td id="depset.order"><code>order</code></td>
<td><a href="../core/string.html" class="anchor">string</a>;
default is <code>"default"</code><br />
The traversal strategy for the new depset. See <a href="../builtins/depset.html">here</a> for the possible values.</td>
</tr>
<tr>
<td id="depset.transitive"><code>transitive</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../builtins/depset.html" class="anchor">depset</a>s; or <code>None</code>;
default is <code>None</code><br />
A list of depsets whose elements will become indirect elements of the depset.</td>
</tr>
</tbody>
</table>

## existing_rule

``` rule-signature
unknown existing_rule(name)
```

Returns an immutable dict-like object that describes the attributes of a rule instantiated in this thread's package, or `None` if no rule instance of that name exists.

Here, an *immutable dict-like object* means a deeply immutable object `x` supporting dict-like iteration, `len(x)`, `name in x`, `x[name]`, `x.get(name)`, `x.items()`, `x.keys()`, and `x.values()`.

The result contains an entry for each attribute, with the exception of private ones (whose names do not start with a letter) and a few unrepresentable legacy attribute types. In addition, the dict contains entries for the rule instance's `name` and `kind` (for example, `'cc_binary'`).

The values of the result represent attribute values as follows:

- Attributes of type str, int, and bool are represented as is.
- Labels are converted to strings of the form `':foo'` for targets in the same package or `'//pkg:name'` for targets in a different package.
- Lists are represented as tuples, and dicts are converted to new, mutable dicts. Their elements are recursively converted in the same fashion.
- `select` values are returned with their contents transformed as described above.
- Attributes for which no value was specified during rule instantiation and whose default value is computed are excluded from the result. (Computed defaults cannot be computed until the analysis phase.).

If possible, use this function only in [implementation functions of rule finalizer symbolic macros](https://bazel.build/extending/macros#finalizers). Use of this function in other contexts is not recommened, and will be disabled in a future Bazel release; it makes `BUILD` files brittle and order-dependent. Also, beware that it differs subtly from the two other conversions of rule attribute values from internal form to Starlark: one used by computed defaults, the other used by `ctx.attr.foo`.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="existing_rule.name"><code>name</code></td>
<td><a href="../core/string.html" class="anchor">string</a>;
required<br />
The name of the target.</td>
</tr>
</tbody>
</table>

## existing_rules

``` rule-signature
unknown existing_rules()
```

Returns an immutable dict-like object describing the rules so far instantiated in this thread's package. Each entry of the dict-like object maps the name of the rule instance to the result that would be returned by `existing_rule(name)`.

Here, an *immutable dict-like object* means a deeply immutable object `x` supporting dict-like iteration, `len(x)`, `name in x`, `x[name]`, `x.get(name)`, `x.items()`, `x.keys()`, and `x.values()`.

If possible, use this function only in [implementation functions of rule finalizer symbolic macros](https://bazel.build/extending/macros#finalizers). Use of this function in other contexts is not recommened, and will be disabled in a future Bazel release; it makes `BUILD` files brittle and order-dependent.

## exports_files

``` rule-signature
None exports_files(srcs, visibility=None, licenses=None)
```

Specifies a list of files belonging to this package that are exported to other packages.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="exports_files.srcs"><code>srcs</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../core/string.html" class="anchor">string</a>s;
required<br />
The list of files to export.</td>
</tr>
<tr>
<td id="exports_files.visibility"><code>visibility</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a>; or <code>None</code>;
default is <code>None</code><br />
A visibility declaration can to be specified. The files will be visible to the targets specified. If no visibility is specified, the files will be visible to every package.</td>
</tr>
<tr>
<td id="exports_files.licenses"><code>licenses</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../core/string.html" class="anchor">string</a>s; or <code>None</code>;
default is <code>None</code><br />
Licenses to be specified.</td>
</tr>
</tbody>
</table>

## glob

``` rule-signature
sequence glob(include=[], exclude=[], exclude_directories=1, allow_empty=unbound)
```

Glob returns a new, mutable, sorted list of every file in the current package that:

- Matches at least one pattern in `include`.
- Does not match any of the patterns in `exclude` (default `[]`).

If the `exclude_directories` argument is enabled (set to `1`), files of type directory will be omitted from the results (default `1`).

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="glob.include"><code>include</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../core/string.html" class="anchor">string</a>s;
default is <code>[]</code><br />
The list of glob patterns to include.</td>
</tr>
<tr>
<td id="glob.exclude"><code>exclude</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../core/string.html" class="anchor">string</a>s;
default is <code>[]</code><br />
The list of glob patterns to exclude.</td>
</tr>
<tr>
<td id="glob.exclude_directories"><code>exclude_directories</code></td>
<td><a href="../core/int.html" class="anchor">int</a>;
default is <code>1</code><br />
A flag whether to exclude directories or not.</td>
</tr>
<tr>
<td id="glob.allow_empty"><code>allow_empty</code></td>
<td>default is <code>unbound</code><br />
Whether we allow glob patterns to match nothing. If `allow_empty` is False, each individual include pattern must match something and also the final result must be non-empty (after the matches of the `exclude` patterns are excluded).</td>
</tr>
</tbody>
</table>

## module_name

``` rule-signature
string module_name()
```

The name of the Bazel module associated with the repo this package is in. If this package is from a repo defined in WORKSPACE instead of MODULE.bazel, this is empty. For repos generated by module extensions, this is the name of the module hosting the extension. It's the same as the `module.name` field seen in `module_ctx.modules`.
May return `None`.

## module_version

``` rule-signature
string module_version()
```

The version of the Bazel module associated with the repo this package is in. If this package is from a repo defined in WORKSPACE instead of MODULE.bazel, this is empty. For repos generated by module extensions, this is the version of the module hosting the extension. It's the same as the `module.version` field seen in `module_ctx.modules`.
May return `None`.

## package

``` rule-signature
unknown package(**kwargs)
```

Declares metadata that applies to every rule in the package. It must be called at most once within a package (BUILD file). If called, it should be the first call in the BUILD file, right after the `load()` statements.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="package.kwargs"><code>kwargs</code></td>
<td>required<br />
See the <a href="/reference/be/functions#package"><code>package()</code></a> function in the Build Encyclopedia for applicable arguments.</td>
</tr>
</tbody>
</table>

## package_default_visibility

``` rule-signature
List package_default_visibility()
```

Returns the default visibility of the package being evaluated. This is the value of the `default_visibility` parameter of `package()`, extended to include the package itself.

## package_group

``` rule-signature
None package_group(*, name, packages=[], includes=[])
```

This function defines a set of packages and assigns a label to the group. The label can be referenced in `visibility` attributes.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="package_group.name"><code>name</code></td>
<td><a href="../core/string.html" class="anchor">string</a>;
required<br />
The unique name for this rule.</td>
</tr>
<tr>
<td id="package_group.packages"><code>packages</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../core/string.html" class="anchor">string</a>s;
default is <code>[]</code><br />
A complete enumeration of packages in this group.</td>
</tr>
<tr>
<td id="package_group.includes"><code>includes</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../core/string.html" class="anchor">string</a>s;
default is <code>[]</code><br />
Other package groups that are included in this one.</td>
</tr>
</tbody>
</table>

## package_name

``` rule-signature
string package_name()
```

The name of the package being evaluated, without the repository name. For example, in the BUILD file `some/package/BUILD`, its value will be `some/package`. If the BUILD file calls a function defined in a .bzl file, `package_name()` will match the caller BUILD file package. The value will always be an empty string for the root package.

## package_relative_label

``` rule-signature
Label package_relative_label(input)
```

Converts the input string into a [Label](../builtins/Label.html) object, in the context of the package currently being initialized (that is, the `BUILD` file for which the current macro is executing). If the input is already a `Label`, it is returned unchanged.

This function may only be called while evaluating a BUILD file and the macros it directly or indirectly calls; it may not be called in (for instance) a rule implementation function.

The result of this function is the same `Label` value as would be produced by passing the given string to a label-valued attribute of a target declared in the BUILD file.

*Usage note:* The difference between this function and [Label()](../builtins/Label.html#Label) is that `Label()` uses the context of the package of the `.bzl` file that called it, not the package of the `BUILD` file. Use `Label()` when you need to refer to a fixed target that is hardcoded into the macro, such as a compiler. Use `package_relative_label()` when you need to normalize a label string supplied by the BUILD file to a `Label` object. (There is no way to convert a string to a `Label` in the context of a package other than the BUILD file or the calling .bzl file. For that reason, outer macros should always prefer to pass Label objects to inner macros rather than label strings.)

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="package_relative_label.input"><code>input</code></td>
<td><a href="../core/string.html" class="anchor">string</a>; or <a href="../builtins/Label.html" class="anchor">Label</a>;
required<br />
The input label string or Label object. If a Label object is passed, it's returned as is.</td>
</tr>
</tbody>
</table>

## repo_name

``` rule-signature
string repo_name()
```

The canonical name of the repository containing the package currently being evaluated, with no leading at-signs.

## repository_name

``` rule-signature
string repository_name()
```

**Experimental**. This API is experimental and may change at any time. Please do not depend on it. It may be enabled on an experimental basis by setting `--+incompatible_enable_deprecated_label_apis`  
**Deprecated.** Prefer to use [`repo_name`](#repo_name) instead, which doesn't contain the spurious leading at-sign, but behaves identically otherwise.

The canonical name of the repository containing the package currently being evaluated, with a single at-sign (`@`) prefixed. For example, in packages that are called into existence by the WORKSPACE stanza `local_repository(name='local', path=...)` it will be set to `@local`. In packages in the main repository, it will be set to `@`.

## select

``` rule-signature
unknown select(x, no_match_error='')
```

`select()` is the helper function that makes a rule attribute [configurable](/reference/be/common-definitions#configurable-attributes). See [build encyclopedia](/reference/be/functions#select) for details.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="select.x"><code>x</code></td>
<td><a href="../core/dict.html" class="anchor">dict</a>;
required<br />
A dict that maps configuration conditions to values. Each key is a <a href="../builtins/Label.html">Label</a> or a label string that identifies a config_setting or constraint_value instance. See the <a href="https://bazel.build/extending/legacy-macros#label-resolution">documentation on macros</a> for when to use a Label instead of a string. If <code>--incompatible_resolve_select_keys_eagerly</code> is enabled, the keys are resolved to <code>Label</code> objects relative to the package of the file that contains this call to <code>select</code>.</td>
</tr>
<tr>
<td id="select.no_match_error"><code>no_match_error</code></td>
<td><a href="../core/string.html" class="anchor">string</a>;
default is <code>''</code><br />
Optional custom error to report if no condition matches.</td>
</tr>
</tbody>
</table>

## subpackages

``` rule-signature
sequence subpackages(*, include, exclude=[], allow_empty=False)
```

Returns a new mutable list of every direct subpackage of the current package, regardless of file-system directory depth. List returned is sorted and contains the names of subpackages relative to the current package. It is advised to prefer using the methods in bazel_skylib.subpackages module rather than calling this function directly.

### Parameters

<table class="table table-bordered table-condensed table-params">
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td id="subpackages.include"><code>include</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../core/string.html" class="anchor">string</a>s;
required<br />
The list of glob patterns to include in subpackages scan.</td>
</tr>
<tr>
<td id="subpackages.exclude"><code>exclude</code></td>
<td><a href="../core/list.html" class="anchor">sequence</a> of <a href="../core/string.html" class="anchor">string</a>s;
default is <code>[]</code><br />
The list of glob patterns to exclude from subpackages scan.</td>
</tr>
<tr>
<td id="subpackages.allow_empty"><code>allow_empty</code></td>
<td><a href="../core/bool.html" class="anchor">bool</a>;
default is <code>False</code><br />
Whether we fail if the call returns an empty list. By default empty list indicates potential error in BUILD file where the call to subpackages() is superflous. Setting to true allows this function to succeed in that case.</td>
</tr>
</tbody>
</table>
